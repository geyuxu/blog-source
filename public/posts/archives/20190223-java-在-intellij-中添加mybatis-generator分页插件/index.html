<!doctype html>
<html lang="en-us">
  <head>
    <title>在 Intellij 中添加mybatis-generator分页插件 // My New Hugo Site</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.57.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="http://example.org/css/main.min.59023e5fd38d6ecb0e1dfbb295077c3c67e00e3b9eb3feaf34b5a5e6b332897a.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="在 Intellij 中添加mybatis-generator分页插件"/>
<meta name="twitter:description" content="mybatis-genreator并没有为我们实现分页操作，本文介绍如何编写mybatis-genreator插件实现分页。

前期工作：在 Intellij 中搭建 mybatis-genreator 环境。"/>

    <meta property="og:title" content="在 Intellij 中添加mybatis-generator分页插件" />
<meta property="og:description" content="mybatis-genreator并没有为我们实现分页操作，本文介绍如何编写mybatis-genreator插件实现分页。

前期工作：在 Intellij 中搭建 mybatis-genreator 环境。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/archives/20190223-java-%E5%9C%A8-intellij-%E4%B8%AD%E6%B7%BB%E5%8A%A0mybatis-generator%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6/" />
<meta property="article:published_time" content="2015-11-02T20:19:39+00:00" />
<meta property="article:modified_time" content="2015-11-02T20:19:39+00:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="http://example.org/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <h1>My New Hugo Site</h1>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
      <div class="app-header-social">
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">在 Intellij 中添加mybatis-generator分页插件</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Nov 2, 2015
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          4 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="http://example.org/tags/java/">java</a><a class="tag" href="http://example.org/tags/mybatis/">mybatis</a><a class="tag" href="http://example.org/tags/genreator/">genreator</a></div></div>
    </header>
    <div class="post-content">
      <p>mybatis-genreator并没有为我们实现分页操作，本文介绍如何编写mybatis-genreator插件实现分页。</p>

<p>前期工作：在 Intellij 中搭建 mybatis-genreator 环境。</p>

<p>步骤：<br />
1.添加插件类</p>

<pre><code>package com.geyuxu.utils;

import org.mybatis.generator.api.CommentGenerator;
import org.mybatis.generator.api.IntrospectedTable;
import org.mybatis.generator.api.PluginAdapter;
import org.mybatis.generator.api.dom.java.*;
import org.mybatis.generator.api.dom.xml.Attribute;
import org.mybatis.generator.api.dom.xml.Document;
import org.mybatis.generator.api.dom.xml.TextElement;
import org.mybatis.generator.api.dom.xml.XmlElement;

import java.util.List;

public class OraclePaginationPlugin extends PluginAdapter {
    private static String PAGE_URI = &quot;com.geyuxu.utils.Page&quot;;

    @Override
    public boolean modelExampleClassGenerated(TopLevelClass topLevelClass, IntrospectedTable introspectedTable) {
        addPage(topLevelClass, introspectedTable, &quot;page&quot;);
        return super.modelExampleClassGenerated(topLevelClass,
                introspectedTable);
    }

    @Override
    public boolean sqlMapDocumentGenerated(Document document,
                                           IntrospectedTable introspectedTable) {
        XmlElement parentElement = document.getRootElement();

        // 产生分页语句前半部分
        XmlElement paginationPrefixElement = new XmlElement(&quot;sql&quot;);
        paginationPrefixElement.addAttribute(new Attribute(&quot;id&quot;,
                &quot;OracleDialectPrefix&quot;));
        XmlElement pageStart = new XmlElement(&quot;if&quot;);
        pageStart.addAttribute(new Attribute(&quot;test&quot;, &quot;page != null&quot;));
        pageStart.addElement(new TextElement(
                &quot;select * from ( select row_.*, rownum rownum_ from ( &quot;));
        paginationPrefixElement.addElement(pageStart);
        parentElement.addElement(paginationPrefixElement);

        // 产生分页语句后半部分
        XmlElement paginationSuffixElement = new XmlElement(&quot;sql&quot;);
        paginationSuffixElement.addAttribute(new Attribute(&quot;id&quot;,
                &quot;OracleDialectSuffix&quot;));
        XmlElement pageEnd = new XmlElement(&quot;if&quot;);
        pageEnd.addAttribute(new Attribute(&quot;test&quot;, &quot;page != null&quot;));
        pageEnd.addElement(new TextElement(
                &quot;&lt;![CDATA[ ) row_ ) where rownum_ &gt; #{page.begin} and rownum_ &lt;= #{page.end} ]]&gt;&quot;));
        paginationSuffixElement.addElement(pageEnd);
        parentElement.addElement(paginationSuffixElement);

        return super.sqlMapDocumentGenerated(document, introspectedTable);
    }

    @Override
    public boolean sqlMapSelectByExampleWithoutBLOBsElementGenerated(
            XmlElement element, IntrospectedTable introspectedTable) {

        XmlElement pageStart = new XmlElement(&quot;include&quot;); //$NON-NLS-1$
        pageStart.addAttribute(new Attribute(&quot;refid&quot;, &quot;OracleDialectPrefix&quot;));
        element.getElements().add(0, pageStart);

        XmlElement isNotNullElement = new XmlElement(&quot;include&quot;); //$NON-NLS-1$
        isNotNullElement.addAttribute(new Attribute(&quot;refid&quot;,
                &quot;OracleDialectSuffix&quot;));
        element.getElements().add(isNotNullElement);

        return super.sqlMapUpdateByExampleWithoutBLOBsElementGenerated(element,
                introspectedTable);
    }

    /**
     * @param topLevelClass
     * @param introspectedTable
     * @param name
     */
    private void addPage(TopLevelClass topLevelClass,
                         IntrospectedTable introspectedTable, String name) {
        topLevelClass.addImportedType(new FullyQualifiedJavaType(
                PAGE_URI));
        CommentGenerator commentGenerator = context.getCommentGenerator();
        Field field = new Field();
        field.setVisibility(JavaVisibility.PROTECTED);
        field.setType(new FullyQualifiedJavaType(PAGE_URI));
        field.setName(name);
        commentGenerator.addFieldComment(field, introspectedTable);
        topLevelClass.addField(field);
        char c = name.charAt(0);
        String camel = Character.toUpperCase(c) + name.substring(1);
        Method method = new Method();
        method.setVisibility(JavaVisibility.PUBLIC);
        method.setName(&quot;set&quot; + camel);
        method.addParameter(new Parameter(new FullyQualifiedJavaType(
                PAGE_URI), name));
        method.addBodyLine(&quot;this.&quot; + name + &quot;=&quot; + name + &quot;;&quot;);
        commentGenerator.addGeneralMethodComment(method, introspectedTable);
        topLevelClass.addMethod(method);
        method = new Method();
        method.setVisibility(JavaVisibility.PUBLIC);
        method.setReturnType(new FullyQualifiedJavaType(
                PAGE_URI));
        method.setName(&quot;get&quot; + camel);
        method.addBodyLine(&quot;return &quot; + name + &quot;;&quot;);
        commentGenerator.addGeneralMethodComment(method, introspectedTable);
        topLevelClass.addMethod(method);
    }

    @Override
    public boolean validate(List&lt;String&gt; list) {
        return true;
    }
}
</code></pre>

<p>2.添加Page类</p>

<pre><code>package com.geyuxu.utils;

import java.util.List;

public class Page&lt;T&gt; {
    // 分页查询开始记录位置
    private int begin;
    // 分页查看下结束位置
    private int end;
    // 每页显示记录数
    private int length;
    // 查询结果总记录数
    private int count;
    // 当前页码
    private int current;
    // 总共页数
    private int total;

    private List&lt;T&gt; list;


    /**
     * 构造函数
     */

    public Page(Integer pageNo) {
        this(pageNo,10);
    }

    public Page(Integer pageNo,Integer length) {
        this.current = pageNo;
        this.length = length == null?10:length;
        this.begin = (this.current - 1) * this.length ;
        this.end = this.begin + this.length;
    }

    /**
     * @return the begin
     */
    public int getBegin() {
        return begin;
    }

    /**
     * @return the end
     */
    public int getEnd() {
        return end;
    }

    /**
     * @param end the end to set
     */
    public void setEnd(int end) {
        this.end = end;
    }

    /**
     * @param begin the begin to set
     */
    public void setBegin(int begin) {
        this.begin = begin;
        if (this.length != 0) {
            this.current = (int) Math.floor((this.begin * 1.0d) / this.length) + 1;
        }
    }

    /**
     * @return the length
     */
    public int getLength() {
        return length;
    }

    /**
     * @param length the length to set
     */
    public void setLength(int length) {
        this.length = length;
        if (this.begin != 0) {
            this.current = (int) Math.floor((this.begin * 1.0d) / this.length) + 1;
        }
    }

    /**
     * @return the count
     */
    public int getCount() {
        return count;
    }

    /**
     * @param count the count to set
     */
    public void setCount(int count) {
        this.count = count;
        this.total = (int) Math.floor((this.count * 1.0d) / this.length);
        if (this.count % this.length != 0) {
            this.total++;
        }
    }

    /**
     * @return the current
     */
    public int getCurrent() {
        return current;
    }

    /**
     * @param current the current to set
     */
    public void setCurrent(int current) {
        this.current = current;
    }

    /**
     * @return the total
     */
    public int getTotal() {
        if (total == 0) {
            return 1;
        }
        return total;
    }

    /**
     * @param total the total to set
     */
    public void setTotal(int total) {
        this.total = total;
    }

    public List&lt;T&gt; getList() {
        return list;
    }

    public void setList(List&lt;T&gt; list) {
        this.list = list;
    }
}
</code></pre>

<p>3.将OraclePaginationPlugin打成 jar 包</p>

<p>在菜单『File&gt;Project Structure&gt;Artifacts&gt;+(Add)&gt;Jar&gt;Empty』<br />
Name 设置为pagination-0.1<br />
Output Directory 选择一个合适的目录，我这里选的是桌面『/Users/geyuxu/Desktop』
添加一个目录，Directory Content<br />
<img src="https://img.geyuxu.com/2015-11-02-1.png" alt="img" /><br />
选择 生成class 文件所在的目录，我这里是 target/classes</p>

<p>4.将打好的 jar 包导入到 maven 本地库中
Edit Configurations<br />
<img src="https://img.geyuxu.com/2015-11-02-2.png" alt="img" /><br />
maven<br />
<img src="https://img.geyuxu.com/2015-11-02-3.png" alt="img" /><br />
name 随便填，Working directory 选当前项目的目录<br />
<img src="https://img.geyuxu.com/2015-11-02-4.png" alt="img" /><br />
Command line:</p>

<pre><code>install:install-file -Dfile=/Users/geyuxu/Desktop/pagination-0.1.jar -DgroupId=com.geyuxu.utils -DartifactId=pagination -Dversion=0.1 -Dpackaging=jar
</code></pre>

<p>5.在[]添加如下选项
<img src="https://img.geyuxu.com/2015-11-02-5.png" alt="img" /></p>

<p>6.修改 pom文件</p>

<pre><code>    &lt;/plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.3.2&lt;/version&gt;
            &lt;configuration&gt;
                &lt;verbose&gt;true&lt;/verbose&gt;
                &lt;overwrite&gt;true&lt;/overwrite&gt;
            &lt;/configuration&gt;
            &lt;dependencies&gt;
                &lt;dependency&gt;
                    &lt;groupId&gt;com.geyuxu.utils&lt;/groupId&gt;
                    &lt;artifactId&gt;pagination&lt;/artifactId&gt;
                    &lt;version&gt;0.1&lt;/version&gt;
                &lt;/dependency&gt;
            &lt;/dependencies&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
</code></pre>

<p>使用方法：</p>

<pre><code>int pageNum = 1;
int pageSize = 10;
StudentExample example = new StudentExample();
Page&lt;Student&gt; page = new Page&lt;Student&gt;(pageNum,pageSize);
example.setPage(page);
page.setCount(studentMapper.countByExample(example));
List&lt;Student&gt; students = studentMapper.selectByExample(example);
page.setList(students);
</code></pre>

<hr />

<p>参考资料：<br />
<a href="http://blog.csdn.net/aking21alinjuju/article/details/9357893">Mybatis Generator实现分页功能</a><br />
<a href="http://blog.csdn.net/xzknet/article/details/44158009">mybatis generator生成带有分页的Mybatis代码</a><br />
<a href="http://bbs.csdn.net/topics/390841395">http://bbs.csdn.net/topics/390841395</a><br />
<a href="http://www.iteye.com/problems/103171">http://www.iteye.com/problems/103171</a><br />
<a href="http://blog.csdn.net/z69183787/article/details/46560071">Intellij IDEA 14中使用MyBatis-generator 自动生成MyBatis代码</a></p>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
