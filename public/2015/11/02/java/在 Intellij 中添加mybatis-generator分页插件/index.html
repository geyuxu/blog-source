<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="葛于旭日志">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        在 Intellij 中添加mybatis-generator分页插件 - 葛于旭日志
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> 学习笔记、随想 </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/img/h.png" />
        </div>
        <div class="name">
            <i>Yasin Ge</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i> 学习笔记、随想 </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        在 Intellij 中添加mybatis-generator分页插件
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2015-11-02 20:19:39</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#java" title="java">java</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#mybatis" title="mybatis">mybatis</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#genreator" title="genreator">genreator</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <p>mybatis-genreator并没有为我们实现分页操作，本文介绍如何编写mybatis-genreator插件实现分页。</p>
<p>前期工作：在 Intellij 中搭建 mybatis-genreator 环境。<br><a id="more"></a><br>步骤：<br>1.添加插件类</p>
<pre><code>package com.geyuxu.utils;

import org.mybatis.generator.api.CommentGenerator;
import org.mybatis.generator.api.IntrospectedTable;
import org.mybatis.generator.api.PluginAdapter;
import org.mybatis.generator.api.dom.java.*;
import org.mybatis.generator.api.dom.xml.Attribute;
import org.mybatis.generator.api.dom.xml.Document;
import org.mybatis.generator.api.dom.xml.TextElement;
import org.mybatis.generator.api.dom.xml.XmlElement;

import java.util.List;

public class OraclePaginationPlugin extends PluginAdapter {
    private static String PAGE_URI = &quot;com.geyuxu.utils.Page&quot;;

    @Override
    public boolean modelExampleClassGenerated(TopLevelClass topLevelClass, IntrospectedTable introspectedTable) {
        addPage(topLevelClass, introspectedTable, &quot;page&quot;);
        return super.modelExampleClassGenerated(topLevelClass,
                introspectedTable);
    }

    @Override
    public boolean sqlMapDocumentGenerated(Document document,
                                           IntrospectedTable introspectedTable) {
        XmlElement parentElement = document.getRootElement();

        // 产生分页语句前半部分
        XmlElement paginationPrefixElement = new XmlElement(&quot;sql&quot;);
        paginationPrefixElement.addAttribute(new Attribute(&quot;id&quot;,
                &quot;OracleDialectPrefix&quot;));
        XmlElement pageStart = new XmlElement(&quot;if&quot;);
        pageStart.addAttribute(new Attribute(&quot;test&quot;, &quot;page != null&quot;));
        pageStart.addElement(new TextElement(
                &quot;select * from ( select row_.*, rownum rownum_ from ( &quot;));
        paginationPrefixElement.addElement(pageStart);
        parentElement.addElement(paginationPrefixElement);

        // 产生分页语句后半部分
        XmlElement paginationSuffixElement = new XmlElement(&quot;sql&quot;);
        paginationSuffixElement.addAttribute(new Attribute(&quot;id&quot;,
                &quot;OracleDialectSuffix&quot;));
        XmlElement pageEnd = new XmlElement(&quot;if&quot;);
        pageEnd.addAttribute(new Attribute(&quot;test&quot;, &quot;page != null&quot;));
        pageEnd.addElement(new TextElement(
                &quot;&lt;![CDATA[ ) row_ ) where rownum_ &gt; #{page.begin} and rownum_ &lt;= #{page.end} ]]&gt;&quot;));
        paginationSuffixElement.addElement(pageEnd);
        parentElement.addElement(paginationSuffixElement);

        return super.sqlMapDocumentGenerated(document, introspectedTable);
    }

    @Override
    public boolean sqlMapSelectByExampleWithoutBLOBsElementGenerated(
            XmlElement element, IntrospectedTable introspectedTable) {

        XmlElement pageStart = new XmlElement(&quot;include&quot;); //$NON-NLS-1$
        pageStart.addAttribute(new Attribute(&quot;refid&quot;, &quot;OracleDialectPrefix&quot;));
        element.getElements().add(0, pageStart);

        XmlElement isNotNullElement = new XmlElement(&quot;include&quot;); //$NON-NLS-1$
        isNotNullElement.addAttribute(new Attribute(&quot;refid&quot;,
                &quot;OracleDialectSuffix&quot;));
        element.getElements().add(isNotNullElement);

        return super.sqlMapUpdateByExampleWithoutBLOBsElementGenerated(element,
                introspectedTable);
    }

    /**
     * @param topLevelClass
     * @param introspectedTable
     * @param name
     */
    private void addPage(TopLevelClass topLevelClass,
                         IntrospectedTable introspectedTable, String name) {
        topLevelClass.addImportedType(new FullyQualifiedJavaType(
                PAGE_URI));
        CommentGenerator commentGenerator = context.getCommentGenerator();
        Field field = new Field();
        field.setVisibility(JavaVisibility.PROTECTED);
        field.setType(new FullyQualifiedJavaType(PAGE_URI));
        field.setName(name);
        commentGenerator.addFieldComment(field, introspectedTable);
        topLevelClass.addField(field);
        char c = name.charAt(0);
        String camel = Character.toUpperCase(c) + name.substring(1);
        Method method = new Method();
        method.setVisibility(JavaVisibility.PUBLIC);
        method.setName(&quot;set&quot; + camel);
        method.addParameter(new Parameter(new FullyQualifiedJavaType(
                PAGE_URI), name));
        method.addBodyLine(&quot;this.&quot; + name + &quot;=&quot; + name + &quot;;&quot;);
        commentGenerator.addGeneralMethodComment(method, introspectedTable);
        topLevelClass.addMethod(method);
        method = new Method();
        method.setVisibility(JavaVisibility.PUBLIC);
        method.setReturnType(new FullyQualifiedJavaType(
                PAGE_URI));
        method.setName(&quot;get&quot; + camel);
        method.addBodyLine(&quot;return &quot; + name + &quot;;&quot;);
        commentGenerator.addGeneralMethodComment(method, introspectedTable);
        topLevelClass.addMethod(method);
    }

    @Override
    public boolean validate(List&lt;String&gt; list) {
        return true;
    }
}
</code></pre><p>2.添加Page类</p>
<pre><code>package com.geyuxu.utils;

import java.util.List;

public class Page&lt;T&gt; {
    // 分页查询开始记录位置
    private int begin;
    // 分页查看下结束位置
    private int end;
    // 每页显示记录数
    private int length;
    // 查询结果总记录数
    private int count;
    // 当前页码
    private int current;
    // 总共页数
    private int total;

    private List&lt;T&gt; list;


    /**
     * 构造函数
     */

    public Page(Integer pageNo) {
        this(pageNo,10);
    }

    public Page(Integer pageNo,Integer length) {
        this.current = pageNo;
        this.length = length == null?10:length;
        this.begin = (this.current - 1) * this.length ;
        this.end = this.begin + this.length;
    }

    /**
     * @return the begin
     */
    public int getBegin() {
        return begin;
    }

    /**
     * @return the end
     */
    public int getEnd() {
        return end;
    }

    /**
     * @param end the end to set
     */
    public void setEnd(int end) {
        this.end = end;
    }

    /**
     * @param begin the begin to set
     */
    public void setBegin(int begin) {
        this.begin = begin;
        if (this.length != 0) {
            this.current = (int) Math.floor((this.begin * 1.0d) / this.length) + 1;
        }
    }

    /**
     * @return the length
     */
    public int getLength() {
        return length;
    }

    /**
     * @param length the length to set
     */
    public void setLength(int length) {
        this.length = length;
        if (this.begin != 0) {
            this.current = (int) Math.floor((this.begin * 1.0d) / this.length) + 1;
        }
    }

    /**
     * @return the count
     */
    public int getCount() {
        return count;
    }

    /**
     * @param count the count to set
     */
    public void setCount(int count) {
        this.count = count;
        this.total = (int) Math.floor((this.count * 1.0d) / this.length);
        if (this.count % this.length != 0) {
            this.total++;
        }
    }

    /**
     * @return the current
     */
    public int getCurrent() {
        return current;
    }

    /**
     * @param current the current to set
     */
    public void setCurrent(int current) {
        this.current = current;
    }

    /**
     * @return the total
     */
    public int getTotal() {
        if (total == 0) {
            return 1;
        }
        return total;
    }

    /**
     * @param total the total to set
     */
    public void setTotal(int total) {
        this.total = total;
    }

    public List&lt;T&gt; getList() {
        return list;
    }

    public void setList(List&lt;T&gt; list) {
        this.list = list;
    }
}
</code></pre><p>3.将OraclePaginationPlugin打成 jar 包</p>
<p>在菜单『File&gt;Project Structure&gt;Artifacts&gt;+(Add)&gt;Jar&gt;Empty』<br>Name 设置为pagination-0.1<br>Output Directory 选择一个合适的目录，我这里选的是桌面『/Users/geyuxu/Desktop』<br>添加一个目录，Directory Content<br><img src="http://img.geyuxu.com/2015-11-02-1.png" alt="img"><br>选择 生成class 文件所在的目录，我这里是 target/classes</p>
<p>4.将打好的 jar 包导入到 maven 本地库中<br>Edit Configurations<br><img src="http://img.geyuxu.com/2015-11-02-2.png" alt="img"><br>maven<br><img src="http://img.geyuxu.com/2015-11-02-3.png" alt="img"><br>name 随便填，Working directory 选当前项目的目录<br><img src="http://img.geyuxu.com/2015-11-02-4.png" alt="img"><br>Command line:    </p>
<pre><code>install:install-file -Dfile=/Users/geyuxu/Desktop/pagination-0.1.jar -DgroupId=com.geyuxu.utils -DartifactId=pagination -Dversion=0.1 -Dpackaging=jar
</code></pre><p>5.在[]添加如下选项<br><img src="http://img.geyuxu.com/2015-11-02-5.png" alt="img">   </p>
<p>6.修改 pom文件</p>
<pre><code>&lt;/plugins&gt;
    &lt;plugin&gt;
        &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;
        &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.3.2&lt;/version&gt;
        &lt;configuration&gt;
            &lt;verbose&gt;true&lt;/verbose&gt;
            &lt;overwrite&gt;true&lt;/overwrite&gt;
        &lt;/configuration&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.geyuxu.utils&lt;/groupId&gt;
                &lt;artifactId&gt;pagination&lt;/artifactId&gt;
                &lt;version&gt;0.1&lt;/version&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/plugin&gt;
&lt;/plugins&gt;
</code></pre><p>使用方法：</p>
<pre><code>int pageNum = 1;
int pageSize = 10;
StudentExample example = new StudentExample();
Page&lt;Student&gt; page = new Page&lt;Student&gt;(pageNum,pageSize);
example.setPage(page);
page.setCount(studentMapper.countByExample(example));
List&lt;Student&gt; students = studentMapper.selectByExample(example);
page.setList(students);
</code></pre><hr>
<p>参考资料：<br><a href="http://blog.csdn.net/aking21alinjuju/article/details/9357893" target="_blank" rel="noopener">Mybatis Generator实现分页功能</a><br><a href="http://blog.csdn.net/xzknet/article/details/44158009" target="_blank" rel="noopener">mybatis generator生成带有分页的Mybatis代码</a><br><a href="http://bbs.csdn.net/topics/390841395" target="_blank" rel="noopener">http://bbs.csdn.net/topics/390841395</a><br><a href="http://www.iteye.com/problems/103171" target="_blank" rel="noopener">http://www.iteye.com/problems/103171</a><br><a href="http://blog.csdn.net/z69183787/article/details/46560071" target="_blank" rel="noopener">Intellij IDEA 14中使用MyBatis-generator 自动生成MyBatis代码</a></p>

        
        <div id="comment-container">
        </div>
    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        
        <li>
            <a target="_blank" href="https://weibo.com/geyuxu">
                            <span class="fa-stack fa-lg">
                                  <i class="iconfont icon-weibo"></i>
                            </span>
            </a>
        </li>
        

        

        
        <li>
            <a target="_blank"  href="https://github.com/geyuxu">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        <!--Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a><br />-->
        <br />&copy; 2018 Yasin Ge&nbsp;&nbsp;<a href="http://www.miitbeian.gov.cn/" target="_blank">苏ICP备14055844号</a>
    </p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</html>
